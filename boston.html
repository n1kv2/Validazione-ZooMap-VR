<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boston Test</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4361ee;
            --primary-hover: #3a56d4;
            --success: #4cc9f0;
            --error: #f72585;
            --text: #2b2d42;
            --text-light: #8d99ae;
            --background: #f8f9fa;
            --card: #ffffff;
            --border: #e9ecef;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background);
            color: var(--text);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: var(--card);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            padding: 30px;
        }
        
        h1, h2 {
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 1rem;
        }
        
        h1 {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        h2 {
            font-size: 1.5rem;
        }
        
        p {
            margin-bottom: 1rem;
        }
        
        .intro {
            text-align: center;
            padding: 2rem 0;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        .btn:hover {
            background-color: var(--primary-hover);
            transform: translateY(-2px);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .question-container {
            display: none;
            padding: 1.5rem;
            border-radius: 8px;
            background-color: var(--card);
        }
        
        .question-container.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .image-container {
    width: 100%;
    margin: 1.5rem 0;
    text-align: center;
    position: relative;
}

.image-container img {
    max-width: 100%;
    max-height: 400px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    display: none; /* Inizialmente nascosto */
}

.image-loading {
    display: flex;
    justify-content: center;
    align-items: center;
    height: 400px;
    background: var(--background);
    font-size: 0.9rem;
    color: var(--text-light);
}

.image-container img.loaded {
    display: block; 
    margin: 0 auto;
}

.image-container .image-loading.loaded {
    display: none;
}
        
        .timer-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding: 0.8rem 1rem;
            background-color: rgba(67, 97, 238, 0.1);
            border-radius: 8px;
        }
        
        .timer {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
        }
        
        .progress-container {
            width: 100%;
            margin: 2rem 0;
        }
        
        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .progress-bar {
            height: 8px;
            width: 100%;
            background-color: var(--border);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background-color: var(--primary);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .input-group {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin: 1.5rem 0;
        }
        
        .answer-input {
            flex: 1;
            padding: 12px 16px;
            font-size: 1rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            transition: border 0.2s ease;
        }
        
        .answer-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }
        
        .feedback-container {
            margin-bottom: 1rem;
        }
        
        .feedback {
            padding: 1rem;
            border-radius: 8px;
            display: none;
            animation: fadeIn 0.3s ease;
            margin-bottom: 0.5rem;
        }
        
        .feedback.correct {
            background-color: rgba(76, 201, 240, 0.2);
            border: 1px solid var(--success);
            color: #0d5c75;
        }
        
        .feedback.incorrect {
            background-color: rgba(247, 37, 133, 0.2);
            border: 1px solid var(--error);
            color: #8a1a4a;
        }
        
        .feedback-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .feedback-title i {
            font-size: 1.2rem;
        }
        
        .hint {
            padding: 0.8rem;
            background-color: rgba(139, 92, 246, 0.1);
            border-radius: 6px;
            color: var(--text);
            font-size: 0.95rem;
            border-left: 4px solid #8b5cf6;
            display: none;
        }
        
        .action-buttons {
            display: flex;
            gap: 1rem;
        }
        
        .btn-secondary {
            background-color: white;
            color: var(--primary);
            border: 1px solid var(--primary);
        }
        
        .btn-secondary:hover {
            background-color: rgba(67, 97, 238, 0.1);
        }
        
        .results-container {
            padding: 2rem;
        }
        
        .results-summary {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .result-card {
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
        }
        
        .result-card.correct {
            background-color: rgba(76, 201, 240, 0.1);
            border: 1px solid var(--success);
        }
        
        .result-card.incorrect {
            background-color: rgba(247, 37, 133, 0.1);
            border: 1px solid var(--error);
        }
        
        .result-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 0.5rem 0;
        }
        
        .result-label {
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .question-times {
            list-style: none;
        }
        
        .question-time {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid var(--border);
        }
        
        .pdf-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            background: var(--background);
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .pdf-container embed {
            opacity: 0;
            transition: opacity 0.5s ease;
            width: 100%;
            height: 100%;
        }
        
        .pdf-container embed.loaded {
            opacity: 1;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .results-summary {
                grid-template-columns: 1fr;
            }
            
            .input-group {
                flex-direction: column;
                align-items: stretch;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <h1>Boston Test</h1>
        
        <div class="progress-container">
            <div class="progress-text">
                <span>Progresso</span>
                <span id="progress-percent">0%</span>
            </div>
            <div class="progress-bar">
                <div class="progress" id="progress"></div>
            </div>
        </div>
        
        <div id="intro" class="intro">
            <p>Il test consiste in 30 domande. Per ogni domanda avrai 20 secondi per rispondere.</p>
            <p>Valutazione capacità di denominazione</p>
            <button id="start-btn" class="btn">Inizia il Test</button>
        </div>
        
        <div id="test-container" style="display: none;">
            <div class="timer-container">
                <div class="timer" id="timer">Tempo rimanente: 20s</div>
            </div>
            
            <div id="question-1" class="question-container">
                <h2>Domanda 1</h2>
                <div class="image-container">
    <img id="image-1" src="domande/domanda1.png" alt="Domanda 1" onload="handleImageLoad(1)">
    <div class="image-loading">Caricamento domanda...</div>
</div>
                
                <div class="feedback-container">
                    <div id="feedback-1" class="feedback">
                        <div id="result-1" class="feedback-title"></div>
                    </div>
                    <div id="hint-1" class="hint"></div>
                </div>
                
                <div class="input-group">
                    <input type="text" id="answer-1" class="answer-input" placeholder="Scrivi la risposta qui..." autocomplete="off">
                    <button id="next-1" class="btn">Verifica risposta</button>
                </div>
            </div>
            
            <!-- le altre domande vengono generate automaticamente -->
        </div>
        
        <div id="results" class="results-container" style="display: none;">
            <h2>Risultati del Test</h2>
            
            <div class="results-summary">
                <div class="result-card correct">
                    <div class="result-value" id="correct-answers">0</div>
                    <div class="result-label">Risposte corrette</div>
                </div>
                <div class="result-card incorrect">
                    <div class="result-value" id="wrong-answers">0</div>
                    <div class="result-label">Risposte sbagliate</div>
                </div>
            </div>
            
            <p>Tempo totale impiegato: <strong id="total-time">0</strong> secondi</p>
            
            <h3 style="margin-top: 2rem;">Tempi per domanda:</h3>
            <ul class="question-times" id="question-times"></ul>
            
            <div style="text-align: center; margin-top: 2rem;">
                <button onclick="window.location.href='menu.html'" class="btn">Torna al Menu</button>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Configurazione del test
        const totalQuestions = 31;
        const timePerQuestion = 23; // secondi + 3 per caricamento file 
        const correctAnswers = {
            1: "risposta1",
            // qui bisogna aggiungere le risposte corrette 
            30: "risposta30"
        };
        
        const hints = {
            1: "Suggerimento per la domanda 1: prova a pensare a...",
            // qui invece vanno aggiunti i suggerimenti 
            30: "Suggerimento per la domanda 30: considera che..."
        };
        
        let currentQuestion = 1;
        let timer;
        let timeLeft;
        let startTime;
        let questionTimes = Array(totalQuestions).fill(0);
        let userAnswers = Array(totalQuestions).fill("");
        let correctCount = 0;
        let wrongCount = 0;
        let pdfLoaded = false;
        
        const introSection = document.getElementById('intro');
        const testContainer = document.getElementById('test-container');
        const resultsSection = document.getElementById('results');
        const timerElement = document.getElementById('timer');
        const progressBar = document.getElementById('progress');
        const progressPercent = document.getElementById('progress-percent');
        const startBtn = document.getElementById('start-btn');
        
        // Gestisce il caricamento del PDF
        function handleImageLoad(questionNum) {
    const img = document.getElementById(`image-${questionNum}`);
    const container = img.parentElement;
    const loadingElement = container.querySelector('.image-loading');
    
    if (loadingElement) {
        loadingElement.classList.add('loaded');
    }
    img.classList.add('loaded');
    pdfLoaded = true;
    
    if (parseInt(questionNum) === currentQuestion) {
        startTimer(questionNum);
    }
}
        
        // Genera le domande dinamicamente
function generateQuestions() {
    const container = document.getElementById('test-container');
    
    for (let i = 2; i <= totalQuestions; i++) {
        const questionDiv = document.createElement('div');
        questionDiv.id = `question-${i}`;
        questionDiv.className = 'question-container';
        
        questionDiv.innerHTML = `
            <h2>Domanda ${i}</h2>
            <div class="image-container">
                <img id="image-${i}" src="domande/domanda${i}.png" alt="Domanda ${i}" onload="handleImageLoad(${i})">
                <div class="image-loading">Caricamento domanda...</div>
            </div>
            
            <div class="feedback-container">
                <div id="feedback-${i}" class="feedback">
                    <div id="result-${i}" class="feedback-title"></div>
                </div>
                <div id="hint-${i}" class="hint"></div>
            </div>
            
            <div class="input-group">
                <input type="text" id="answer-${i}" class="answer-input" placeholder="Scrivi la risposta qui..." autocomplete="off">
                <button id="next-${i}" class="btn">Verifica risposta</button>
            </div>
        `;
        
        container.appendChild(questionDiv);
    }
}
        
        // Pre-carica i PDF successivi
        function preloadNextImage(currentNum) {
            const nextNum = currentNum + 1;
            if (nextNum <= totalQuestions) {
        const img = document.getElementById(`image-${nextNum}`);
        if (img) {
            img.src = img.getAttribute('src');
        }
    }
}
        
        // Inizia il test
        function startTest() {
            introSection.style.display = 'none';
            testContainer.style.display = 'block';
            showQuestion(currentQuestion);
            generateQuestions();
        }
        
        // Mostra una specifica domanda
        function showQuestion(questionNum) {
            // Nascondi tutte le domande
            document.querySelectorAll('.question-container').forEach(q => {
                q.classList.remove('active');
            });
            
            // Mostra la domanda corrente
            const questionElement = document.getElementById(`question-${questionNum}`);
            questionElement.classList.add('active');
            
            // Resetta lo stato della domanda
            document.getElementById(`answer-${questionNum}`).value = '';
            document.getElementById(`answer-${questionNum}`).disabled = false;
            document.getElementById(`feedback-${questionNum}`).style.display = 'none';
            document.getElementById(`hint-${questionNum}`).style.display = 'none';
            document.getElementById(`next-${questionNum}`).textContent = 'Verifica risposta';
            document.getElementById(`next-${questionNum}`).className = 'btn';
            
            // Resetta lo stato di caricamento
            pdfLoaded = false;
            
            // Avvia il timer SOLO se il PDF è già caricato
               const img = document.getElementById(`image-${questionNum}`);
                if (img.complete) {
                    handleImageLoad(questionNum);
             }
            
            // Aggiorna la barra di progresso
            updateProgressBar(questionNum);
            
            // Focus sull'input
            document.getElementById(`answer-${questionNum}`).focus();
            
            // Pre-carica la prossima domanda
            preloadNextImage(questionNum);
        }
        
        // Timer functions
        function startTimer(questionNum) {
            // Avvia il timer SOLO se il PDF è caricato
            if (!pdfLoaded) return;
            
            startTime = new Date().getTime();
            timeLeft = timePerQuestion;
            updateTimerDisplay();
            
            timer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    timeUp(questionNum);
                }
            }, 1000);
        }
        
        function resetTimer() {
            clearInterval(timer);
        }
        
        function updateTimerDisplay() {
            timerElement.textContent = `Tempo rimanente: ${timeLeft}s`;
            
            // Cambia colore quando il tempo sta per scadere
            if (timeLeft <= 5) {
                timerElement.style.color = 'var(--error)';
            } else {
                timerElement.style.color = 'var(--primary)';
            }
        }
        
        // Tempo scaduto
        function timeUp(questionNum) {
            // Registra il tempo massimo
            questionTimes[questionNum-1] = timePerQuestion;
            
            // Mostra feedback
            const feedbackElement = document.getElementById(`feedback-${questionNum}`);
            const resultElement = document.getElementById(`result-${questionNum}`);
            const hintElement = document.getElementById(`hint-${questionNum}`);
            const nextButton = document.getElementById(`next-${questionNum}`);
            
            feedbackElement.style.display = 'block';
            feedbackElement.className = 'feedback incorrect';
            resultElement.innerHTML = '<i class="fas fa-times-circle"></i> Tempo scaduto!';
            hintElement.textContent = hints[questionNum];
            hintElement.style.display = 'block';
            
            // Disabilita input e cambia pulsante
            document.getElementById(`answer-${questionNum}`).disabled = true;
            nextButton.textContent = 'Prosegui';
            nextButton.className = 'btn';
            
            // Incrementa contatore se non era già corretta
            if (userAnswers[questionNum-1] !== correctAnswers[questionNum]) {
                wrongCount++;
            }
            
            // Aggiorna l'handler per passare alla prossima domanda
            nextButton.onclick = function() {
                nextQuestion(questionNum);
            };
        }
        
        // Verifica la risposta
        function checkAnswer(questionNum) {
            const userAnswer = document.getElementById(`answer-${questionNum}`).value.trim().toLowerCase();
            userAnswers[questionNum-1] = userAnswer;
            
            // Registra il tempo impiegato
            const endTime = new Date().getTime();
            questionTimes[questionNum-1] = Math.round((endTime - startTime) / 1000);
            
            // Verifica la risposta
            const isCorrect = userAnswer === correctAnswers[questionNum];
            
            // Mostra feedback
            const feedbackElement = document.getElementById(`feedback-${questionNum}`);
            const resultElement = document.getElementById(`result-${questionNum}`);
            const hintElement = document.getElementById(`hint-${questionNum}`);
            const nextButton = document.getElementById(`next-${questionNum}`);
            
            feedbackElement.style.display = 'block';
            
            if (isCorrect) {
                feedbackElement.className = 'feedback correct';
                resultElement.innerHTML = '<i class="fas fa-check-circle"></i> Risposta corretta!';
                hintElement.style.display = 'none';
                correctCount++;
                
                // Disabilita input e cambia testo pulsante
                document.getElementById(`answer-${questionNum}`).disabled = true;
                nextButton.textContent = 'Prosegui';
                nextButton.className = 'btn';
                
                // Ferma il timer
                resetTimer();
                
                // Quando cliccano "Prosegui" DOPO aver visto il feedback
                nextButton.onclick = function() {
                    nextQuestion(questionNum);
                };
            } else {
                feedbackElement.className = 'feedback incorrect';
                resultElement.innerHTML = '<i class="fas fa-times-circle"></i> Risposta errata';
                hintElement.textContent = hints[questionNum];
                hintElement.style.display = 'block';
                
                // Cambia testo pulsante e mantieni sulla stessa domanda
                nextButton.textContent = 'Riprova';
                nextButton.className = 'btn btn-secondary';
                document.getElementById(`answer-${questionNum}`).value = '';
                document.getElementById(`answer-${questionNum}`).focus();
                
                // Resetta l'handler per verificare di nuovo la risposta
                nextButton.onclick = function() {
                    checkAnswer(questionNum);
                };
            }
        }
        
        // Passa alla domanda successiva
        function nextQuestion(currentQNum) {
            if (currentQNum < totalQuestions) {
                currentQuestion = currentQNum + 1;
                showQuestion(currentQuestion);
            } else {
                finishTest();
            }
        }
        
        // Aggiorna la barra di progresso
        function updateProgressBar(currentQNum) {
            const progress = (currentQNum / totalQuestions) * 100;
            progressBar.style.width = `${progress}%`;
            progressPercent.textContent = `${Math.round(progress)}%`;
        }
        
        // Fine del test
        function finishTest() {
            testContainer.style.display = 'none';
            resultsSection.style.display = 'block';
            
            // Calcola il tempo totale
            const totalTime = questionTimes.reduce((sum, time) => sum + time, 0);
            
            // Aggiorna i risultati
            document.getElementById('correct-answers').textContent = correctCount;
            document.getElementById('wrong-answers').textContent = wrongCount;
            document.getElementById('total-time').textContent = totalTime;
            
            // Mostra i tempi per ogni domanda
            const timesList = document.getElementById('question-times');
            timesList.innerHTML = '';
            questionTimes.forEach((time, index) => {
                const li = document.createElement('li');
                li.className = 'question-time';
                li.innerHTML = `<span>Domanda ${index+1}</span><span>${time} secondi</span>`;
                timesList.appendChild(li);
            });
            
            // Salva i risultati nel localStorage
            saveResults(correctCount, wrongCount, totalTime);
            
            // Aggiorna lo stato del test nel menu
            updateTestProgress();
        }
        
        // Salva i risultati nel localStorage
        function saveResults(correct, wrong, totalTime) {
            const results = {
                correct: correct,
                wrong: wrong,
                totalTime: totalTime,
                completed: true,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('bostonTestResults', JSON.stringify(results));
        }
        
        // Aggiorna lo stato del test nel menu
        function updateTestProgress() {
            // Carica lo stato attuale dei test
            let testProgress = JSON.parse(localStorage.getItem('testProgress')) || {};
            
            // Aggiorna lo stato del Boston Test
            testProgress.bostonTest = true;
            
            // Salva nuovamente nel localStorage
            localStorage.setItem('testProgress', JSON.stringify(testProgress));
        }
        
        // Event Listeners
        startBtn.addEventListener('click', startTest);
        
        // Gestione click sul pulsante
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('btn') && e.target.id.startsWith('next-')) {
                const questionNum = parseInt(e.target.id.split('-')[1]);
                checkAnswer(questionNum);
            }
        });
        
        // Gestione tasto Invio
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const activeQuestion = document.querySelector('.question-container.active');
                if (activeQuestion) {
                    const questionNum = parseInt(activeQuestion.id.split('-')[1]);
                    checkAnswer(questionNum);
                }
            }
        });
        
        // Espone la funzione handlePdfLoad per gli embed
        window.handlePdfLoad = handlePdfLoad;
    });
    </script>
</body>
</html>